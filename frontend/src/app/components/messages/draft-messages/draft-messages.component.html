<div class="container">
  <div class="header">
    <h2>Drafts</h2>
    <div class="search">
      <input type="text" [(ngModel)]="query" (ngModelChange)="applyFilter()" placeholder="Search drafts..." />
      <button class="btn" (click)="load()">Refresh</button>
    </div>
  </div>

  <div class="alert-error" *ngIf="error">{{ error }}</div>
  <div *ngIf="loading" class="loading">Loading...</div>

  <div class="list" *ngIf="!loading && filtered.length === 0">
    <p>No drafts found</p>
  </div>

  <div class="content" *ngIf="!loading && filtered.length > 0">
    <div class="list">
      <ul>
        <li *ngFor="let m of filtered" (click)="select(m)" [class.selected]="selected?.id === m.id">
          <div class="subject">{{ m.subject }}</div>
          <div class="meta">
            <span>{{ m.parentName || 'Parent' }}</span>
            <span>{{ formatDate(m.createdAt) }}</span>
          </div>
          <div class="reason" *ngIf="m.failedReason">Reason: {{ m.failedReason }}</div>
        </li>
      </ul>
    </div>
    <div class="detail" *ngIf="selected">
      <h3>{{ selected.subject }}</h3>
      <div class="meta">
        <span>{{ selected.parentName || 'Parent' }}</span>
        <span>{{ formatDate(selected.createdAt) }}</span>
      </div>
      <pre class="body">{{ selected.message }}</pre>
      <div class="actions">
        <button class="btn btn-primary" (click)="resend(selected)">Resend</button>
      </div>
    </div>
  </div>
</div>
