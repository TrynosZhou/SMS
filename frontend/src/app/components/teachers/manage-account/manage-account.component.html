<div class="container">
  <div class="manage-account-card">
    <div class="card-header">
      <h2>{{ isAccountant ? 'Change Password' : 'Manage Account' }}</h2>
      <p class="subtitle">{{ isAccountant ? 'Update your password' : 'Update your username and password' }}</p>
    </div>

    <div class="alert alert-success" *ngIf="success">{{ success }}</div>
    <div class="alert alert-error" *ngIf="error">{{ error }}</div>

    <div *ngIf="loading && !accountInfo" class="loading-message">
      Loading account information...
    </div>

    <form *ngIf="accountInfo" (ngSubmit)="updateAccount()">
      <div class="form-group">
        <label>{{ isTeacher ? 'Username (TeacherID)' : 'Username' }}</label>
        <input 
          type="text" 
          [value]="currentUsername || 'N/A'" 
          [disabled]="true"
          class="disabled-input">
        <small class="form-text" *ngIf="isTeacher">Your username is your TeacherID and cannot be changed.</small>
        <small class="form-text" *ngIf="!isTeacher">This is your current username</small>
      </div>

      <div class="form-group" *ngIf="!isTeacher && !isAccountant">
        <label>Current Email</label>
        <input 
          type="email" 
          [value]="currentEmail || 'N/A'" 
          disabled
          class="disabled-input">
        <small class="form-text">This is your current email address</small>
      </div>

      <div class="form-group" *ngIf="!isTeacher && !isAccountant">
        <label>New Email</label>
        <input 
          type="email" 
          [(ngModel)]="newEmail" 
          name="newEmail" 
          placeholder="Enter new email (optional)" 
          autocomplete="email">
        <small class="form-text">Enter a new email address (leave blank to keep current)</small>
      </div>

      <div class="info-box" *ngIf="isTeacher && mustChangePassword">
        <span class="info-icon">âš ï¸</span>
        <p><strong>First Login:</strong> You must change your temporary password. Your username (TeacherID) cannot be changed.</p>
      </div>

      <div class="form-group">
        <label>Current Password *</label>
        <div class="password-input-wrapper">
          <input 
            [type]="showCurrentPassword ? 'text' : 'password'" 
            [(ngModel)]="currentPassword" 
            name="currentPassword" 
            placeholder="Enter current password" 
            required
            autocomplete="current-password">
          <span class="password-toggle" (click)="toggleCurrentPasswordVisibility()">
            {{ showCurrentPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
          </span>
        </div>
      </div>

      <div class="form-group">
        <label>New Password *</label>
        <div class="password-input-wrapper">
          <input 
            [type]="showNewPassword ? 'text' : 'password'" 
            [(ngModel)]="newPassword" 
            name="newPassword" 
            placeholder="At least 8 characters" 
            required
            minlength="8"
            autocomplete="new-password">
          <span class="password-toggle" (click)="toggleNewPasswordVisibility()">
            {{ showNewPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
          </span>
        </div>
        <div class="strength-meter">
          <div class="strength-bar" [ngClass]="strengthClass"></div>
          <span class="strength-label">{{ strengthLabel }}</span>
        </div>
        <ul class="password-requirements">
          <li [class.valid]="passwordLengthOk">â€¢ At least 8 characters</li>
          <li [class.valid]="hasUpper">â€¢ At least one uppercase letter</li>
          <li [class.valid]="hasLower">â€¢ At least one lowercase letter</li>
          <li [class.valid]="hasNumber">â€¢ At least one number</li>
          <li [class.valid]="hasSpecial">â€¢ At least one special character</li>
        </ul>
      </div>

      <div class="form-group">
        <label>Confirm New Password *</label>
        <div class="password-input-wrapper">
          <input 
            [type]="showConfirmPassword ? 'text' : 'password'" 
            [(ngModel)]="confirmPassword" 
            name="confirmPassword" 
            placeholder="Confirm new password" 
            required
            autocomplete="new-password">
          <span class="password-toggle" (click)="toggleConfirmPasswordVisibility()">
            {{ showConfirmPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
          </span>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="!canSubmit">
          {{ loading ? 'Updating...' : 'ğŸ’¾ Update Account' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="goToDashboard()" [disabled]="loading">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
