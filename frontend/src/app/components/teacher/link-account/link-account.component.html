<div class="link-account-container">
  <div class="link-account-card">
    <header class="card-header">
      <div class="header-content">
        <h1>Link Teacher Account</h1>
        <p class="subtitle">
          Connect your login account to your teacher profile to access your assigned classes and exam management features.
        </p>
      </div>
      <div class="header-actions">
        <button type="button" class="btn btn-secondary" (click)="cancel()">
          ← Back to Dashboard
        </button>
      </div>
    </header>

    <main class="card-content">
      <!-- Search Form -->
      <section class="search-section" *ngIf="!foundTeacher">
        <div class="section-header">
          <h2>Find Your Teacher Profile</h2>
          <p>Enter your EmployeeID to locate your teacher profile</p>
        </div>

        <form [formGroup]="linkForm" (ngSubmit)="searchTeacher()" class="search-form">
          <div class="form-group">
            <label for="teacherId">EmployeeID *</label>
            <div class="input-with-button">
              <input
                id="teacherId"
                type="text"
                formControlName="teacherId"
                placeholder="e.g., JPST0001"
                class="form-input"
              />
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="loading || linkForm.invalid"
              >
                <span *ngIf="loading" class="spinner"></span>
                {{ loading ? 'Searching...' : 'Search' }}
              </button>
            </div>
            <small class="helper-text">
              Your EmployeeID should be provided by your school administrator.
            </small>
          </div>
        </form>

        <!-- Alerts -->
        <div class="alert alert-error" *ngIf="error">
          <span class="alert-icon">⚠️</span>
          {{ error }}
        </div>

        <div class="alert alert-info" *ngIf="currentUser?.username && !loading">
          <span class="alert-icon">ℹ️</span>
          Your login username (EmployeeID) is: <strong>{{ currentUser.username }}</strong>
        </div>
      </section>

      <!-- Teacher Found Section -->
      <section class="confirmation-section" *ngIf="foundTeacher">
        <div class="section-header">
          <h2>Teacher Profile Found</h2>
          <p>Please confirm this is your profile before linking</p>
        </div>

        <div class="teacher-profile-card">
          <div class="profile-header">
            <div class="profile-avatar">
              <span class="avatar-text">{{ foundTeacher.firstName?.charAt(0) }}{{ foundTeacher.lastName?.charAt(0) }}</span>
            </div>
            <div class="profile-info">
              <h3>{{ foundTeacher.fullName }}</h3>
              <p class="employee-id">EmployeeID: {{ foundTeacher.teacherId }}</p>
            </div>
          </div>

          <div class="profile-details">
            <div class="detail-row">
              <span class="detail-label">First Name:</span>
              <span class="detail-value">{{ foundTeacher.firstName }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Last Name:</span>
              <span class="detail-value">{{ foundTeacher.lastName }}</span>
            </div>
            <div class="detail-row" *ngIf="foundTeacher.phoneNumber">
              <span class="detail-label">Phone:</span>
              <span class="detail-value">{{ foundTeacher.phoneNumber }}</span>
            </div>
            <div class="detail-row" *ngIf="foundTeacher.address">
              <span class="detail-label">Address:</span>
              <span class="detail-value">{{ foundTeacher.address }}</span>
            </div>
          </div>

          <div class="profile-sections" *ngIf="foundTeacher.subjects?.length || foundTeacher.classes?.length">
            <div class="section" *ngIf="foundTeacher.subjects?.length">
              <h4>Assigned Subjects</h4>
              <div class="tag-list">
                <span class="tag" *ngFor="let subject of foundTeacher.subjects">
                  {{ subject.name }}
                </span>
              </div>
            </div>
            
            <div class="section" *ngIf="foundTeacher.classes?.length">
              <h4>Assigned Classes</h4>
              <div class="tag-list">
                <span class="tag" *ngFor="let classItem of foundTeacher.classes">
                  {{ classItem.name }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Alerts -->
        <div class="alert alert-success" *ngIf="success">
          <span class="alert-icon">✅</span>
          {{ success }}
        </div>

        <div class="alert alert-error" *ngIf="error">
          <span class="alert-icon">⚠️</span>
          {{ error }}
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="clearSearch()"
            [disabled]="linking"
          >
            Search Again
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="linkAccount()"
            [disabled]="linking"
          >
            <span *ngIf="linking" class="spinner"></span>
            {{ linking ? 'Linking...' : 'Link My Account' }}
          </button>
        </div>
      </section>
    </main>
  </div>
</div>
