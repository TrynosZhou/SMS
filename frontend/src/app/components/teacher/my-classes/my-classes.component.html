<div class="my-classes-container">
  <div class="page-header">
    <div class="header-content">
      <span class="header-icon">ğŸ«</span>
      <h1>My Classes</h1>
      <span class="header-welcome" *ngIf="teacherName && teacherName !== 'Teacher'">
        Welcome, <strong>{{ teacherName }}</strong> â€“ View all classes assigned to you
      </span>
      <span class="header-welcome" *ngIf="!teacherName || teacherName === 'Teacher'">
        View all classes assigned to you
      </span>
    </div>
  </div>

  <!-- Universal teacher: EmployeeID lookup modal -->
  <div *ngIf="showEmployeeIdModal" class="modal-overlay" (click)="$event.target === $event.currentTarget && closeEmployeeIdModal()">
    <div class="modal-content" role="dialog" aria-labelledby="employee-id-modal-title">
      <div class="modal-header">
        <h2 id="employee-id-modal-title">Enter EmployeeID</h2>
        <button type="button" class="modal-close" aria-label="Close" (click)="closeEmployeeIdModal()">&times;</button>
      </div>
      <p class="modal-description">Enter the teacher's EmployeeID to view their assigned classes and open the record book.</p>
      <div *ngIf="lookupError" class="alert alert-error modal-alert">
        <span class="alert-icon">âš ï¸</span>
        <span>{{ lookupError }}</span>
      </div>
      <div class="modal-body">
        <label for="employee-id-input" class="modal-label">EmployeeID</label>
        <input
          id="employee-id-input"
          type="text"
          [(ngModel)]="employeeIdInput"
          (keydown.enter)="searchByEmployeeId()"
          placeholder="e.g. JPST001"
          class="modal-input"
          autofocus>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEmployeeIdModal()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="searchByEmployeeId()" [disabled]="lookupLoading">
          <span *ngIf="!lookupLoading">Look up</span>
          <span *ngIf="lookupLoading">Looking up...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-error">
    <span class="alert-icon">âš ï¸</span>
    <span>{{ error }}</span>
    <button class="alert-close" (click)="error = ''">&times;</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading classes...</p>
  </div>

  <!-- Classes Content (for linked teacher always; for universal teacher only after EmployeeID lookup) -->
  <div *ngIf="!loading && !error && (!isUniversalTeacher || lookedUpTeacher)">
    <!-- Search Box -->
    <div class="search-container">
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="filterClasses()"
          placeholder="Search classes by name, form, or description..."
          class="search-input">
        <button *ngIf="searchTerm" class="clear-search" (click)="clearSearch()">&times;</button>
      </div>
      <div class="class-count">
        <span *ngIf="filteredClasses.length === classes.length">
          {{ classes.length }} class{{ classes.length !== 1 ? 'es' : '' }} assigned
        </span>
        <span *ngIf="filteredClasses.length !== classes.length">
          {{ filteredClasses.length }} of {{ classes.length }} class{{ classes.length !== 1 ? 'es' : '' }}
        </span>
      </div>
    </div>

    <!-- Universal teacher: change teacher / re-open modal -->
    <div *ngIf="isUniversalTeacher && lookedUpTeacher && filteredClasses.length > 0" class="universal-actions">
      <button type="button" class="btn btn-outline" (click)="openEmployeeIdModal()">
        Look up another EmployeeID
      </button>
    </div>

    <!-- Classes Grid -->
    <div *ngIf="filteredClasses.length > 0" class="classes-grid">
      <div *ngFor="let classItem of filteredClasses" class="class-card">
        <div class="class-card-header">
          <div class="class-icon">ğŸ«</div>
          <div class="class-title-section">
            <h3 class="class-name">{{ classItem.name }}</h3>
            <span class="class-form">{{ classItem.form }}</span>
          </div>
          <span class="class-status" [class]="getClassStatusClass(classItem.isActive)">
            {{ getClassStatusText(classItem.isActive) }}
          </span>
        </div>
        <div class="class-card-body">
          <p class="class-subjects" *ngIf="classItem.subjects?.length">
            <strong>Subject(s) taught:</strong> {{ getSubjectNames(classItem.subjects) }}
          </p>
          <p class="class-description" *ngIf="classItem.description">
            {{ classItem.description }}
          </p>
          <p class="class-description" *ngIf="!classItem.description && !classItem.subjects?.length">
            <em>No description available</em>
          </p>
          <p class="class-description" *ngIf="!classItem.description && classItem.subjects?.length">
            <em>No description available</em>
          </p>
        </div>
        <div class="class-card-footer">
          <ng-container *ngIf="classItem.subjects?.length">
            <a *ngFor="let sub of classItem.subjects" class="btn btn-primary record-book-link"
               [routerLink]="['/teacher/record-book']" [queryParams]="{classId: classItem.id, subjectId: sub.id}">
              <span class="btn-icon">ğŸ“š</span>
              <span>Record Book â€“ {{ sub.name }}</span>
            </a>
          </ng-container>
          <a *ngIf="!classItem.subjects?.length" class="btn btn-primary record-book-link"
             [routerLink]="['/teacher/record-book']" [queryParams]="{classId: classItem.id}">
            <span class="btn-icon">ğŸ“š</span>
            <span>Open Record Book</span>
          </a>
        </div>
      </div>
    </div>

    <!-- No Classes Message -->
    <div *ngIf="filteredClasses.length === 0 && !loading" class="no-data">
      <div class="no-data-icon">ğŸ“­</div>
      <h3>No Classes Found</h3>
      <p *ngIf="searchTerm">
        No classes match your search criteria. Try a different search term.
      </p>
      <p *ngIf="!searchTerm && !isUniversalTeacher">
        You are not assigned to any classes yet. Please contact the administrator.
      </p>
      <p *ngIf="!searchTerm && isUniversalTeacher">
        No classes assigned to this teacher. Try another EmployeeID.
      </p>
    </div>
  </div>

  <!-- Universal teacher: prompt to enter EmployeeID when modal is not shown and no lookup yet -->
  <div *ngIf="!loading && !error && isUniversalTeacher && !lookedUpTeacher && !showEmployeeIdModal" class="universal-prompt">
    <p>Enter an EmployeeID to view that teacher's classes and open the record book.</p>
    <button type="button" class="btn btn-primary" (click)="openEmployeeIdModal()">Enter EmployeeID</button>
  </div>
</div>

